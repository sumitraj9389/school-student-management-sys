<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>School Student Management ‚Äî Frontend</title>
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial; padding: 20px; max-width: 980px; margin: auto; }
    h1 { margin-bottom: 6px; }
    .card { border: 1px solid #e0e0e0; padding: 14px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.03); margin-bottom: 16px; }
    label { display:block; margin-top:8px; font-size:14px; }
    input, select { padding:8px; width:100%; box-sizing: border-box; margin-top:4px; }
    button { margin-top:10px; padding:10px 14px; border-radius:6px; border: none; cursor:pointer; }
    .grid { display:grid; gap:12px; grid-template-columns: 1fr 1fr; }
    table { width:100%; border-collapse: collapse; margin-top:12px; }
    th, td { padding:8px 10px; border:1px solid #ddd; text-align:left; }
    .muted { color:#666; font-size:13px; }
    .actions { display:flex; gap:8px; }
    .small { padding:6px 8px; font-size:13px; }
    .success { color: #0b704b; }
    .error { color:#c62828; }
    pre { background:#f7f7f7; padding:10px; border-radius:6px; overflow:auto; }
  </style>
</head>
<body>

  <h1>School Student Management ‚Äî Frontend</h1>
  <p class="muted">Simple UI to test your <code>/students</code> API (POST, GET, PUT, DELETE).</p>

  <div class="card">
    <strong>Create new student</strong>
    <div class="grid">
      <div>
        <label>Roll No</label>
        <input id="create-rollNo" type="number" />
        <label>Name</label>
        <input id="create-name" type="text" />
        <label>Age</label>
        <input id="create-age" type="number" />
      </div>
      <div>
        <label>Grade</label>
        <input id="create-grade" type="text" />
        <label>GPA</label>
        <input id="create-gpa" type="text" />
        <label>&nbsp;</label>
        <button id="create-btn">‚ûï Add Student</button>
      </div>
    </div>
    <div id="create-msg"></div>
  </div>

  <div class="card">
    <strong>Get / Update / Delete by ID</strong>
    <div style="display:flex; gap:10px; align-items:flex-end;">
      <div style="flex:1;">
        <label>Student ID</label>
        <input id="sid" placeholder="Paste MongoDB _id here" />
      </div>

      <div style="display:flex; gap:8px; align-items:center;">
        <button id="get-btn" class="small">üîé Get</button>
        <button id="prefill-btn" class="small">‚§µ Prefill Update</button>
        <button id="delete-btn" class="small">üóë Delete</button>
      </div>
    </div>

    <div id="student-result" style="margin-top:12px;"></div>

    <hr style="margin:12px 0;" />

    <strong>Update student (after prefilling)</strong>
    <div class="grid">
      <div>
        <label>Roll No</label>
        <input id="update-rollNo" type="number" />
        <label>Name</label>
        <input id="update-name" type="text" />
        <label>Age</label>
        <input id="update-age" type="number" />
      </div>
      <div>
        <label>Grade</label>
        <input id="update-grade" type="text" />
        <label>GPA</label>
        <input id="update-gpa" type="text" />
        <label>&nbsp;</label>
        <button id="update-btn">‚úè Update Student</button>
      </div>
    </div>
    <div id="update-msg"></div>
  </div>

  <div class="card">
    <div style="display:flex; justify-content:space-between; align-items:center;">
      <strong>All students</strong>
      <div>
        <button id="refresh-btn" class="small">üîÑ Refresh</button>
        <button id="clear-btn" class="small">üßπ Clear</button>
      </div>
    </div>

    <div id="students-container" style="margin-top:12px;">
      
    </div>
  </div>

  <div class="card">
    <strong>Raw API Info / Logs</strong>
    <pre id="log" style="height:120px"></pre>
  </div>

<script>
  const API_BASE = "http://localhost:5000"; 
  const logEl = document.getElementById("log");

  function log(msg, isError = false) {
    const now = new Date().toLocaleTimeString();
    logEl.textContent = [${now}] ${msg}\\n + logEl.textContent;
    if (isError) console.error(msg); else console.log(msg);
  }

  async function createStudent() {
    const data = {
      rollNo: Number(document.getElementById("create-rollNo").value),
      name: document.getElementById("create-name").value.trim(),
      age: Number(document.getElementById("create-age").value),
      grade: document.getElementById("create-grade").value.trim(),
      gpa: document.getElementById("create-gpa").value.trim()
    };
    try {
      const res = await fetch(API_BASE + "/students", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      });
      const body = await res.json();
      if (!res.ok) throw new Error(body.message || JSON.stringify(body));
      document.getElementById("create-msg").innerHTML = '<span class="success">Student added ‚Äî ID: ' + body._id + '</span>';
      log("Created: " + JSON.stringify(body));
      fetchAll();
    } catch (err) {
      document.getElementById("create-msg").innerHTML = '<span class="error">' + err.message + '</span>';
      log("Create error: " + err.message, true);
    }
  }

  async function fetchAll() {
    try {
      const res = await fetch(API_BASE + "/students");
      const data = await res.json();
      if (!res.ok) throw new Error(data.message || JSON.stringify(data));
      renderTable(data);
      log("Fetched all students (" + data.length + ")");
    } catch (err) {
      document.getElementById("students-container").innerHTML = '<div class="error">Error: ' + err.message + '</div>';
      log("Fetch all error: " + err.message, true);
    }
  }

  function renderTable(items) {
    if (!items || items.length === 0) {
      document.getElementById("students-container").innerHTML = '<div class="muted">No students found.</div>';
      return;
    }
    let html = '<table><thead><tr><th>ID</th><th>Roll</th><th>Name</th><th>Age</th><th>Grade</th><th>GPA</th><th>Actions</th></tr></thead><tbody>';
    for (const s of items) {
      html += `<tr>
        <td style="max-width:220px;word-break:break-all">${s._id}</td>
        <td>${s.rollNo ?? ""}</td>
        <td>${escapeHtml(s.name ?? "")}</td>
        <td>${s.age ?? ""}</td>
        <td>${escapeHtml(s.grade ?? "")}</td>
        <td>${escapeHtml(s.gpa ?? "")}</td>
        <td class="actions">
          <button onclick="quickGet('${s._id}')" class="small">Get</button>
          <button onclick="prefill('${s._id}')" class="small">Prefill</button>
          <button onclick="quickDelete('${s._id}')" class="small">Delete</button>
        </td>
      </tr>`;
    }
    html += '</tbody></table>';
    document.getElementById("students-container").innerHTML = html;
  }

  async function quickGet(id) {
    document.getElementById("sid").value = id;
    await getById();
  }

  async function prefill(id) {
    try {
      const res = await fetch(API_BASE + "/students/" + id);
      const body = await res.json();
      if (!res.ok) throw new Error(body.message || JSON.stringify(body));
      
      document.getElementById("update-rollNo").value = body.rollNo ?? "";
      document.getElementById("update-name").value = body.name ?? "";
      document.getElementById("update-age").value = body.age ?? "";
      document.getElementById("update-grade").value = body.grade ?? "";
      document.getElementById("update-gpa").value = body.gpa ?? "";
      document.getElementById("sid").value = id;
      document.getElementById("student-result").innerHTML = <pre>${JSON.stringify(body, null, 2)}</pre>;
      log("Prefilled update for " + id);
    } catch (err) {
      document.getElementById("student-result").innerHTML = '<span class="error">' + err.message + '</span>';
      log("Prefill error: " + err.message, true);
    }
  }

  async function getById() {
    const id = document.getElementById("sid").value.trim();
    if (!id) { document.getElementById("student-result").innerHTML = '<span class="error">Please provide an ID.</span>'; return; }
    try {
      const res = await fetch(API_BASE + "/students/" + id);
      const body = await res.json();
      if (!res.ok) throw new Error(body.message || JSON.stringify(body));
      document.getElementById("student-result").innerHTML = <pre>${JSON.stringify(body, null, 2)}</pre>;
      log("Fetched " + id);
    } catch (err) {
      document.getElementById("student-result").innerHTML = '<span class="error">' + err.message + '</span>';
      log("Get by ID error: " + err.message, true);
    }
  }

 
    try {
      const res = await fetch(API_BASE + "/students/" + id, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      });
      const body = await res.json();
      if (!res.ok) throw new Error(body.message || JSON.stringify(body));
      document.getElementById("update-msg").innerHTML = '<span class="success">Updated successfully.</span>';
      log("Updated " + id);
      fetchAll();
    } catch (err) {
      document.getElementById("update-msg").innerHTML = '<span class="error">' + err.message + '</span>';
      log("Update error: " + err.message, true);
    }
  }

  async function deleteStudent() {
    const id = document.getElementById("sid").value.trim();
    if (!id) { document.getElementById("student-result").innerHTML = '<span class="error">Provide ID to delete.</span>'; return; }
    if (!confirm("Are you sure you want to delete this student?")) return;
    try {
      const res = await fetch(API_BASE + "/students/" + id, { method: "DELETE" });
      const body = await res.json();
      if (!res.ok) throw new Error(body.message || JSON.stringify(body));
      document.getElementById("student-result").innerHTML = '<span class="success">' + (body.message || 'Deleted') + '</span>';
      log("Deleted " + id);
      fetchAll();
    } catch (err) {
      document.getElementById("student-result").innerHTML = '<span class="error">' + err.message + '</span>';
      log("Delete error: " + err.message, true);
    }
  }


  async function quickDelete(id) {
    if (!confirm("Delete student " + id + " ?")) return;
    try {
      const res = await fetch(API_BASE + "/students/" + id, { method: "DELETE" });
      const body = await res.json();
      if (!res.ok) throw new Error(body.message || JSON.stringify(body));
      log("Quick deleted " + id);
      fetchAll();
    } catch (err) {
      log("Quick delete error: " + err.message, true);
    }
  }

  
  function escapeHtml(s) { return s ? s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;') : ""; }

  document.getElementById("create-btn").addEventListener("click", createStudent);
  document.getElementById("refresh-btn").addEventListener("click", fetchAll);
  document.getElementById("clear-btn").addEventListener("click", () => {
    document.getElementById("students-container").innerHTML = "";
  });
  document.getElementById("get-btn").addEventListener("click", getById);
  document.getElementById("prefill-btn").addEventListener("click", () => {
    const id = document.getElementById("sid").value.trim();
    if (!id) { document.getElementById("student-result").innerHTML = '<span class="error">Provide ID to prefill.</span>'; return; }
    prefill(id);
  });
  document.getElementById("delete-btn").addEventListener("click", deleteStudent);
  document.getElementById("update-btn").addEventListener("click", updateStudent);

  
  fetchAll();
</script>

</body>
</html>
<link rel="stylesheet" href="style.css">